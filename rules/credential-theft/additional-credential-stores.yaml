rules:
  - id: steal-docker-credentials-js
    message: Accessing Docker credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Docker config.json
          - pattern: |
              path.join(os.homedir(), ".docker", "config.json")
          - pattern: |
              fs.readFileSync("=~/.docker/config.json/")
          - pattern: |
              fs.readFile("=~/.docker/config.json/")

  - id: steal-docker-credentials-python
    message: Accessing Docker credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Docker config.json
          - pattern: |
              open(os.path.expanduser("~/.docker/config.json"))
          - pattern: |
              with open(os.path.expanduser("~/.docker/config.json")) as $F:
                  ...
          - pattern: |
              Path.home() / ".docker" / "config.json"
          - pattern: |
              (Path.home() / ".docker" / "config.json").read_text()

  - id: steal-kubernetes-config-js
    message: Accessing Kubernetes config - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Kubernetes config
          - pattern: |
              path.join(os.homedir(), ".kube", "config")
          - pattern: |
              fs.readFileSync("=~/.kube/config/")
          - pattern: |
              fs.readFile("=~/.kube/config/")

  - id: steal-kubernetes-config-python
    message: Accessing Kubernetes config - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Kubernetes config
          - pattern: |
              open(os.path.expanduser("~/.kube/config"))
          - pattern: |
              with open(os.path.expanduser("~/.kube/config")) as $F:
                  ...
          - pattern: |
              Path.home() / ".kube" / "config"
          - pattern: |
              (Path.home() / ".kube" / "config").read_text()

  - id: steal-git-credentials-js
    message: Accessing Git credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Git credentials file
          - pattern: |
              path.join(os.homedir(), ".git-credentials")
          - pattern: |
              fs.readFileSync("=~/.git-credentials/")
          - pattern: |
              fs.readFile("=~/.git-credentials/")

          # .gitconfig
          - pattern: |
              path.join(os.homedir(), ".gitconfig")
          - pattern: |
              fs.readFileSync("=~/.gitconfig/")

  - id: steal-git-credentials-python
    message: Accessing Git credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Git credentials file
          - pattern: |
              open(os.path.expanduser("~/.git-credentials"))
          - pattern: |
              with open(os.path.expanduser("~/.git-credentials")) as $F:
                  ...
          - pattern: |
              Path.home() / ".git-credentials"

          # .gitconfig
          - pattern: |
              open(os.path.expanduser("~/.gitconfig"))
          - pattern: |
              Path.home() / ".gitconfig"

  - id: steal-gpg-keys-js
    message: Accessing GPG private keys - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # GPG keyring
          - pattern: |
              "=~/.gnupg/"
          - pattern: |
              path.join(os.homedir(), ".gnupg", ...)
          - pattern: |
              fs.readFileSync("=~/.gnupg/secring.gpg/")
          - pattern: |
              fs.readFileSync("=~/.gnupg/pubring.gpg/")

  - id: steal-gpg-keys-python
    message: Accessing GPG private keys - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # GPG keyring
          - pattern: |
              open(os.path.expanduser("~/.gnupg/secring.gpg"))
          - pattern: |
              open(os.path.expanduser("~/.gnupg/pubring.gpg"))
          - pattern: |
              Path.home() / ".gnupg" / ...

  - id: steal-cloud-provider-credentials-js
    message: Accessing cloud provider CLI credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Google Cloud
          - pattern: |
              "=~/.config/gcloud/"
          - pattern: |
              path.join(os.homedir(), ".config", "gcloud", ...)

          # Azure
          - pattern: |
              "=~/.azure/"
          - pattern: |
              path.join(os.homedir(), ".azure", ...)

          # DigitalOcean
          - pattern: |
              "=~/.config/doctl/"
          - pattern: |
              path.join(os.homedir(), ".config", "doctl", ...)

  - id: steal-cloud-provider-credentials-python
    message: Accessing cloud provider CLI credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Google Cloud
          - pattern: |
              Path.home() / ".config" / "gcloud" / ...
          - pattern: |
              open(os.path.expanduser("~/.config/gcloud/..."))

          # Azure
          - pattern: |
              Path.home() / ".azure" / ...
          - pattern: |
              open(os.path.expanduser("~/.azure/..."))

  - id: steal-heroku-credentials-js
    message: Accessing Heroku credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Heroku credentials
          - pattern: |
              path.join(os.homedir(), ".netrc")
          - pattern: |
              fs.readFileSync("=~/.netrc/")

  - id: steal-heroku-credentials-python
    message: Accessing Heroku/netrc credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # .netrc file
          - pattern: |
              open(os.path.expanduser("~/.netrc"))
          - pattern: |
              Path.home() / ".netrc"

  - id: steal-terraform-credentials-js
    message: Accessing Terraform credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Terraform credentials
          - pattern: |
              "=~/.terraform.d/"
          - pattern: |
              path.join(os.homedir(), ".terraform.d", ...)

  - id: steal-terraform-credentials-python
    message: Accessing Terraform credentials - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Terraform credentials
          - pattern: |
              Path.home() / ".terraform.d" / ...
          - pattern: |
              open(os.path.expanduser("~/.terraform.d/..."))

  - id: steal-browser-password-store-js
    message: Accessing browser password database - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A04:2021 - Insecure Design"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # Chrome Login Data
          - pattern: |
              "=~/Chrome/.*Login Data/"
          - pattern: |
              "=~/chromium/.*Login Data/"

          # Firefox logins.json
          - pattern: |
              "=~/firefox/.*logins.json/"
          - pattern: |
              "=~/mozilla/firefox/.*logins.json/"

  - id: steal-browser-password-store-python
    message: Accessing browser password database - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A04:2021 - Insecure Design"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Chrome Login Data
          - pattern: |
              Path(...) / "Chrome" / ... / "Login Data"
          - pattern: |
              Path(...) / "chromium" / ... / "Login Data"

          # Firefox logins.json
          - pattern: |
              Path(...) / "firefox" / ... / "logins.json"
          - pattern: |
              Path(...) / "mozilla" / "firefox" / ... / "logins.json"
