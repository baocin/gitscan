rules:
  - id: steal-aws-credentials-js
    message: Reading AWS credentials file - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [javascript, typescript]
    patterns:
      - pattern-either:
          # JavaScript/TypeScript - path.join constructing .aws/credentials paths
          - pattern: path.join(..., ".aws", "credentials")
          - pattern: path.join(os.homedir(), ".aws", "credentials")
          - pattern: path.join(os.homedir(), ".aws", "config")
          - pattern: path.join(..., ".aws", "config")

          # Direct string patterns
          - pattern: fs.readFileSync(..., ".aws/credentials", ...)
          - pattern: fs.readFile(..., ".aws/credentials", ...)
          - pattern: fs.readFileSync(..., ".aws/config", ...)

  - id: steal-aws-credentials-python
    message: Reading AWS credentials file - potential credential theft
    severity: ERROR
    metadata:
      category: info-leak
      cwe: "CWE-522: Insufficiently Protected Credentials"
      owasp: "A02:2021 - Cryptographic Failures"
      confidence: HIGH
    languages: [python]
    patterns:
      - pattern-either:
          # Python - open() with expanduser
          - pattern: open(os.path.expanduser("~/.aws/credentials"))
          - pattern: open(os.path.expanduser("~/.aws/config"))

          # Python - with open()
          - pattern: |
              with open(os.path.expanduser("~/.aws/credentials")) as $F:
                  ...
          - pattern: |
              with open(os.path.expanduser("~/.aws/config")) as $F:
                  ...
